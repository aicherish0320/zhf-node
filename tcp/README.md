# TCP

## OSI 七层模型 （Open System Interconnection）

`OSI` 七层模型，是理想化的模型，将复杂的流程分解为几个功能实现复杂问题简单化

- 7. 应用层（用户最终的接口）微信、QQ
- 6. 表示层（数据的表示、安全、压缩）
- 5. 会话层（建立和管理会话）
- 4. 传输层 **TCP 协议、UDP 协议**
- 3. 网络层（路由器）IP 协议 IPv4 IPv6
- 2. 数据链路层（交换机、网卡）
- 1. 物理层（物理设备，网线、光纤）

> 七层模型是倒着看的，下层是为了上层提供服务的

应用层协议：HTTP DNS
传输层协议：TCP UDP
网络层：IP 协议

> 举个例子：发快递
>
> 1. 需要建立从发货地址到收获地址的通道（公路）
> 2. 找到运输快递的交通工具（运输快递）
> 3. 发送快递时需要标记派送地址，传输过程中可能会丢失（快递会进行再次打包）
> 4. 开始传输，我们邮寄一个汽车（拆包，标记序号等），如果中途丢了，还需要重新发货。
> 5. 和对方建立联系，准备需要发送的数据

总结：应用层（封装）传输层（封装）数据链路层（加头尾封装）最终以比特流的形式传输。对方收到后街封装还原数据。

## IP 地址和 Mac 地址

- 最终通信都是通过 MAC 地址通信，网卡中都有自己的 mac 地址
- 通过 DHCP 协议分配给每台电脑 IP ，通过 ARP 协议将 IP 转化成 mac 地址

## 路由器和交换机

- 交换机：维护 MAC 地址表（交换机端口对应的 mac 地址）不关心 IP 地址。核心就是交换数据，交换效率高
- 路由器：（lan 口、wan 口），在不连接 wan 口的情况下，路由器可以看成是交换机

## 网关

- TCP/IP 中规定两个子网不能直接通信（通过子网掩码来区分两个设备是否是同一个子网），我们从内网访问到外网属于两个不通的子网。路由器就充当了网关的角色。

## TCP/IP 参考模型（五层模型）

Transmission Control Protocol/Internet Protocol ，传输控制协议/网际协议，不仅仅指两个协议（协议簇）

协议就是通信的规则，以 HTTP 协议当做规范来说（协议就是对数据的封装+ 传输）

- 数据链路层、物理层：物理设备
- 网络层：
  - IP 协议： 寻址通过路由器查找，将消息发送给对方路由器，通过 ARP 协议发送自己的 Mac 地址
  - ARP 协议：Address Resolution Protocol 从 IP 地址获取 mac 地址
- 传输层：TCP、UDP
- 应用层：HTTP、DNS、FTP、TFTP、SMTP

## DNS 协议

DNS 是 Domain Name System 的缩写，DNS 服务器进行域名和与之对应的 ip 地址转换的服务器

- 顶级域名 `.com`
- 二级域名 `.com.cn` 三级域名 `www.aic.com.cn`，有多少个点就是几级域名

> 访问过程：我们访问`aic.com.cn`，会先通过 DNS 服务器查找离自己最近的根服务器，通过根服务器找到 `.cn` 服务器，将 ip 返回给 DNS 服务器，DNS 服务器会继续向此 IP 发送请求，去查找对应 `.cn` 下 `.com`对应的 ip，获取最终的 IP 地址，缓存到 DNS 服务器上。
